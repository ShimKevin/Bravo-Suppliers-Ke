{% extends "admin/admin_base.html" %}

{% block admin_content %}
<style>
/* Define padding classes for category indentation */
.pl-0 { padding-left: 0px; }
.pl-1 { padding-left: 20px; }
.pl-2 { padding-left: 40px; }
.pl-3 { padding-left: 60px; }
.pl-4 { padding-left: 80px; }
</style>

<div class="container mt-4">
    <h1 class="mb-4">Add New Product</h1>
    
    <div class="card">
        <div class="card-header bg-primary text-white">
            <h5 class="mb-0">Product Details</h5>
        </div>
        <div class="card-body">
            <form method="POST" enctype="multipart/form-data">
                <div class="mb-3">
                    <label for="name" class="form-label">Product Name</label>
                    <input type="text" class="form-control" id="name" name="name" required>
                </div>
                
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="price" class="form-label">Price (KSh)</label>
                        <input type="number" step="0.01" class="form-control" id="price" name="price" required>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="discount" class="form-label">Discount (%)</label>
                        <input type="number" class="form-control" id="discount" name="discount" value="0" min="0" max="100">
                    </div>
                </div>
                
                <div class="mb-3">
                    <label for="description" class="form-label">Description</label>
                    <textarea class="form-control" id="description" name="description" rows="3"></textarea>
                </div>
                
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <div class="category-dropdown-container">
                            <label for="category" class="form-label">Category</label>
                            <div class="input-group">
                                <input type="text" class="form-control" id="category-input" 
                                       placeholder="Select category" readonly
                                       data-bs-toggle="dropdown" aria-expanded="false">
                                <button class="btn btn-outline-secondary dropdown-toggle" type="button" 
                                        data-bs-toggle="dropdown" aria-expanded="false"></button>
                                
                                <div class="category-dropdown" id="category-dropdown">
                                    {% for id, name, depth in categories %}
                                        <button type="button" class="category-option text-start pl-{{ depth }}" 
                                                data-value="{{ id }}">
                                            {{ name }}
                                        </button>
                                    {% endfor %}
                                </div>
                            </div>
                            <input type="hidden" name="category_id" id="category-id" required>
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="image" class="form-label">Product Image</label>
                        <input class="form-control" type="file" id="image" name="image" accept="image/*" required>
                    </div>
                </div>
                
                <button type="submit" class="btn btn-success">
                    <i class="fas fa-plus me-1"></i> Add Product
                </button>
            </form>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const dropdown = document.getElementById('category-dropdown');
    const categoryInput = document.getElementById('category-input');
    const categoryIdInput = document.getElementById('category-id');
    const toggleBtn = document.querySelector('[data-bs-toggle="dropdown"]');
    
    // Toggle dropdown visibility
    if (toggleBtn) {
        toggleBtn.addEventListener('click', function() {
            dropdown.classList.toggle('show');
        });
    }
    
    // Handle category selection
    if (dropdown) {
        dropdown.querySelectorAll('.category-option').forEach(option => {
            option.addEventListener('click', function() {
                categoryInput.value = this.textContent;
                categoryIdInput.value = this.getAttribute('data-value');
                dropdown.classList.remove('show');
            });
        });
    }
    
    // Close dropdown when clicking outside
    document.addEventListener('click', function(event) {
        const container = document.querySelector('.category-dropdown-container');
        if (!container.contains(event.target)) {
            dropdown.classList.remove('show');
        }
    });
    
    // Make dropdown scrollable
    if (dropdown) {
        dropdown.addEventListener('wheel', function(e) {
            e.stopPropagation();
        });
    }
});
</script>
{% endblock %}
